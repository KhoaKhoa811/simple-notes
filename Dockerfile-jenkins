FROM jenkins/jenkins:2.516.2-jdk17

USER root

## Cập nhật repo + cài Docker, Git, Curl, Unzip, net-tools
#RUN apt-get update && \
#    apt-get install -y docker.io git curl unzip net-tools && \
#    rm -rf /var/lib/apt/lists/*
#
## Cài Docker Compose v2
#RUN mkdir -p /usr/local/lib/docker/cli-plugins && \
#    curl -SL "https://github.com/docker/compose/releases/download/v2.39.2/docker-compose-linux-x86_64" \
#    -o /usr/local/lib/docker/cli-plugins/docker-compose && \
#    chmod +x /usr/local/lib/docker/cli-plugins/docker-compose

# Tạo group docker nếu chưa có và add user jenkins
RUN groupadd -g 999 docker || true && usermod -aG docker jenkins

USER jenkins

# Cài plugin cơ bản
RUN jenkins-plugin-cli --plugins "blueocean docker-workflow git"
